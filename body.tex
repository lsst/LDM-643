
\section{Introduction}

As LSST DM moves from construction through commissioning and into operations 
a number of rehearsals have been proposed to help prepare for the execution 
of the survey.  Specific rehearsals are outlined in \citedsp{LDM-503} but in 
the larger cases, i.e., the OPS Rehearsals (LDM 503-09, LDM 503-11, and 
LDM 503-12) the contents of that document alone, does not sufficiently outline 
the scope, content, action and interaction that are being rehearsed.  
From the software side, \citedsp{LDM-564}
summarizes the DM software features that should be available and helpfully 
identifies those software releases in the context of the rehearsals.  
However, the OPS Rehearsals are not simply periods to test hardware and 
software systems, they are opportunities to understand/develop operations 
processes and to observe the interactions of those hardware/software systems 
and people. 

This document, attempts to outline the OPS Rehearsals in greater detail, 
first because missing/late software features and hardware systems may 
require mitigation (e.g., shims, fake data, etc...) or might be grounds for 
postponement, second because the purpose of an OPS Rehearsal is not to debug 
a freshly deployed system but rather to understand whether that system does
what is needed, and third because the effort to carry out rehearsals will 
require coordination of persons/facilities. 

Note: The current draft attempts to level set this process for one OPS 
rehearsal (the first one).


\section{LDM 503-09: Operations Rehearsal \#1 for Commissioning}

\underline{Date:} November 2018

\underline{Original Description:}
Choose TBD weeks during commissioning. Pick which parts of plan we could 
rehearse.  Chuck suggests Instrument Signal Removal should be the focus 
of this (or the next rehearsal).

\clearpage

\underline{An Updated Goal:}

Mimic sustained nightly ``sampling" mode operations for one week of 
observing.  Archiving and ingestion of raw data, offline processing of 
calibrations and basic image reduction.
\begin{itemize}
\item Sampling mode has been used to describe early LSST commissiong observations where
observations occur based on the needs of the commissioning staff.  Such observations would
typically include some basic set of calibrations (e.g. bias/flat) followed by nightime observations
that might be used to test system performance.  Such observations would not necessarily be run with 
a scheduler and some might not even be appropriate for basic ISR processing.

\item Based on the scheduled time for this exersise the only system that
might produce a ``realistic" data stream (something with expected headers, size, 
and instrumental signatures) would be the AuxTel spectrograph on the testbed in Tucson.

{\it Note: Some alternatives, the ComCam on the SLAC CCOB, might be feasible but the rehearsal dates 
preceed integration of ComCam with an LSST CCS, DAQ, and archiving service.  A third 
alternative would be to use simulated/test-stand AuxTel/ComCam data (again something 
with expected headers, size, and signature) and feed these through a system that makes them 
available for archiving/ingestion at NCSA.}

\item The second element of this rehearsal would be to operate a batch production environment
that would exercise: a pipeline payload, provenance, and production processing along with a 
formal file management system.  These would operate on the data transfered to NCSA.  The ouputs should 
also be archived.  The actual pipeline payload could be as simple as one that reads data, makes
some alteration and tenders an output product for archiving.  More realistic processing would 
depend on both the data being sent to NCSA and the availability of working pipeline processing tasks.

\item Roles include (at least) LDF Production Scientist and “Operator,” 
ISci Ops Calibration and ISR Scientists.  In addition an independent executor
would plan/oversee the activities.
\end{itemize}

\clearpage

\underline{Pre-Requisites:}

\begin{itemize}
\item NOTE: the size/scale of the data (i.e. for AuxTel Spectrograph this would mean CCD-sized) 
is important because it sets a scale for the resources (e.g., disk, CPUs, networking bandwidth)  
needed for the rehearsal.  Depending on the data source, it is not clear that there
would be  systems (or pipelines) that function at an appropriate scale at the time of this rehearsal.  
Finally, it should be considered that any element that uses a fake process will in turn require 
effort to produce the "shim" to fake that action.
\item Requires RAW images and calibrations to feed the system.
    \begin{itemize}
    \item Minimum: Can be as simple as a single image for each data type  (that can be replicated to feed the system).
    \item Stretch: A simulated set of images and base calibrations (e.g. bias/flat).
    \end{itemize}
\item Requires a mechanism to feed RAW images into system.
\item Requires an endpoint to receive files and messages (that activate processing).
\item Requires a means to gather calibrations and initiate calibration processing when all have arrived.
\item Requires a Calibration Pipeline to exercise.
    \begin{itemize}
    \item Minimum: Read files and output a cal (can be as simple as a null... in DES-speak null calibrations were files with the right specs (e.g. header, size) to be considered a calibration by downstream processing but which contained constant values, typically 1 or 0 depending whether the calibration is multiplicative or additive).
    \item Stretch: Capable of producing a calibration set (e.g. a rudimentary combined bias/flat).
    \end{itemize}
\item Requires a production pipeline to exercise:
    \begin{itemize}
    \item Minimum: Read incoming files and cals and produce a new output product.
    \item Stretch: Actually perform basic ISR on simulated images.
    \end{itemize}
\item Requires a service to receive pipeline outputs.
\item Requires a base level ability to track/verify outputs are created.  Depending on whether stretch goals are being attempted likely need ability to look at output images (and catalogs?).
\end{itemize}


\clearpage

\underline{Actions:}

\begin{itemize}
\item Assemble proto-ops team; all components from DM into services, with payloads, data sets, configurations, etc. (assumes pre-integration work) -- checklist
\item Mock receive nightly cals and science images, ingest.
\item Mock afternoon stand-up operations meeting.
\item Generate nightly calibrations for ~1 week of observations.
\item Run nightly ISR (offline mode) for ~1 week of observations.
\item Set up, configure, select calibrations, ingest outputs.
\item Generate feedback for discussion in stand-ups (as a stretch goal this could also include telemetry that would be returned to Observatory)?
\item Monitor progress of nightly “campaigns,” characterize and assess, make records of failures, diagnose issues, generate problem backlog.
\item Create mock nightly reports.
\end{itemize}

%\clearpage

\underline{Software Products and Services Needed:}

Based on the actions being undertaken in this rehearsal the following services are needed: 
Camera DAQ and Archiving Services, Data Backbone Services and Batch Production Services.   
These services are implemented within the following sofware products:
\begin{itemize}
\item Batch Production Software (Michelle Butler)
\item Science Pipeline Software (Robert Lupton)
\item Supporting Software (e.g., Data Butler): (Jim Bosch)
\end{itemize}
Since many of these are in a nascent state, often a shim (or some user-driven actions) 
may be needed to emulate some elements.

% \item Data Backbone Services (Michelle Butler)
% \item Offline Service (Batch Production) (Michelle Butler)
% \item Camera DAQ and Archiving Services (not in LDM-294 product tree)

\clearpage

\underline{Assess:}

\begin{itemize}
\item Was the rehearsal successful? How long did it take? What anomalies/failure modes were identified, and how did team cope? 
\item What fixes are needed, and on what timescale (e.g., next ops rehearsal, or we are go for commissioning)? 
\item What improvements in procedures, documentation, frameworks, systems, and algorithms were identified?
\item Budget time and effort to plan and execute priority changes and improvements, and plan for next rehearsal.
\end{itemize}


